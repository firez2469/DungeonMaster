console.log("Starting canvas code");import{createNewObject,loadObjectData,setEntityData,getTemplates,loadedPreviousEntityData}from"./FirebaseLoader.mjs";import{entityData}from"./FirebaseLoader.mjs";var create_mode_btn=document.getElementById("create_mode_btn"),edit_mode_btn=document.getElementById("edit_mode_btn");create_mode_btn.onclick=function(){mode("create"),setState("create")},edit_mode_btn.onclick=function(){mode("edit"),setState("edit")};var canvas=document.getElementById("#playersCanvas"),ctx=canvas.getContext("2d");ctx.font="16px Arial",ctx.canvas.width=.75*window.innerWidth,ctx.canvas.height=window.innerHeight/2;var pPosX=0,pPosY=0,playerIconLink="https://pic.onlinewebfonts.com/svg/img_235012.png",enemyIconLink="https://media.discordapp.net/attachments/884300143548063754/985266517744685096/full-face.png",typeSelected="player",img_icon=new Image;img_icon.src=playerIconLink;var canvasX,canvasY,placedObjects=[],templateObjects=[];ctx.fillStyle="#09f";var selectedNameVar,currentColor=ctx.fillStyle,state="create",playersIndex=0,isDown=!1,imgWidth=20,imgHeight=20,wasFirebaseLoaded=!1;window.onload=function(){selectedNameVar=document.getElementById("namefield")},document.getElementById("clearbtn").onclick=function(){clearScreen()};var selectedIndex=-1;function renderCanvas(){ctx.canvas.width=.6*window.innerWidth,ctx.canvas.height=window.innerHeight/2;var t=canvas.getBoundingClientRect();canvasX=Math.round(e.clientX-t.left),canvasY=Math.round(e.clientY-t.top),ctx.clearRect(0,0,canvas.width,canvas.height),setOnClicks();for(let e=0;e<placedObjects.length;e++){if("object"!=typeof placedObjects[e].img){var c=new Image;"player"==placedObjects[e].img?c.src=playerIconLink:c.src=enemyIconLink,placedObjects[e].img=c}draw_img(ctx,placedObjects[e].img,placedObjects[e].color,placedObjects[e].x,placedObjects[e].y,imgWidth,imgHeight)}"create"==state?(setImage(),draw_img(ctx,img_icon,currentColor,canvasX-imgWidth/2,canvasY-imgHeight/2,imgWidth,imgHeight)):"edit"==state&&isDown&&dist(parseFloat(placedObjects[selectedIndex].x),parseFloat(placedObjects[selectedIndex].y),canvasX-imgWidth/2,canvasY-imgHeight/2)<150&&(placedObjects[selectedIndex].x=canvasX-imgWidth/2,placedObjects[selectedIndex].y=canvasY-imgHeight/2)}function draw_img(e,t,c,a,l,d,n){t.complete&&e.drawImage(t,a,l,d,n)}canvas.addEventListener("mousemove",(function(e){ctx.canvas.width=.6*window.innerWidth,ctx.canvas.height=window.innerHeight/2;var t=canvas.getBoundingClientRect();canvasX=Math.round(e.clientX-t.left),canvasY=Math.round(e.clientY-t.top),ctx.clearRect(0,0,canvas.width,canvas.height),setOnClicks();for(let e=0;e<placedObjects.length;e++){if("object"!=typeof placedObjects[e].img){var c=new Image;"player"==placedObjects[e].img?c.src=playerIconLink:c.src=enemyIconLink,placedObjects[e].img=c}draw_img(ctx,placedObjects[e].img,placedObjects[e].color,placedObjects[e].x,placedObjects[e].y,imgWidth,imgHeight)}"create"==state?(setImage(),draw_img(ctx,img_icon,currentColor,canvasX-imgWidth/2,canvasY-imgHeight/2,imgWidth,imgHeight)):"edit"==state&&isDown&&dist(parseFloat(placedObjects[selectedIndex].x),parseFloat(placedObjects[selectedIndex].y),canvasX-imgWidth/2,canvasY-imgHeight/2)<150&&(placedObjects[selectedIndex].x=canvasX-imgWidth/2,placedObjects[selectedIndex].y=canvasY-imgHeight/2)})),canvas.addEventListener("click",(function(e){if(setOnClicks(),isDown=!1,"create"==state){var t=getNewName(),c=typeSelected;typeSelected.includes("template")&&(c=typeSelected.split("template")[1]);var a=getTemplates()[c],l={img:img_icon,x:canvasX-imgWidth/2,y:canvasY-imgHeight/2,color:currentColor,name:t,desc:"",template:c};for(var d in a)"name"!=d&&(l[d]=a[d],null!=a[d]&&"undefined"!=a[d]&&null!=a[d]||(l[d]="skills"!=d||"abilities"!=d||"spells"!=d||"desc"!=d?10:"N/A"));placedObjects.push(l),currentColor="hsl("+360*Math.random()+", 50%, 50%",(img_icon=new Image).src=playerIconLink}else if("edit"==state)for(var n=0;n<placedObjects.length;n++){if(null!=placedObjects[n])if(dist(canvasX,canvasY,parseFloat(placedObjects[n].x)+imgWidth/2,parseFloat(placedObjects[n].y)+imgHeight/2)<=.75*imgWidth){updateEntityValues(n,selectedNameVar),selectedNameVar=document.getElementById("namefield");var s=document.getElementById("descfield"),i=document.getElementById("acfield"),o=document.getElementById("hpfield"),m=document.getElementById("sizefield"),p=document.getElementById("speedfield"),r=document.getElementById("strfield"),g=document.getElementById("dexfield"),u=document.getElementById("confield"),b=document.getElementById("intfield"),v=document.getElementById("wisfield"),O=document.getElementById("chafield"),j=document.getElementById("skillsfield"),I=document.getElementById("abilitiesfield"),y=document.getElementById("spellsfield");-1!=selectedIndex&&(placedObjects[selectedIndex].name=selectedNameVar.innerHTML,placedObjects[selectedIndex].desc=s.innerHTML,placedObjects[selectedIndex].ac=i.value,placedObjects[selectedIndex].hp=o.value,placedObjects[selectedIndex].size=m.value,placedObjects[selectedIndex].speed=p.value,placedObjects[selectedIndex].str=r.value,placedObjects[selectedIndex].dex=g.value,placedObjects[selectedIndex].con=u.value,placedObjects[selectedIndex].int=b.value,placedObjects[selectedIndex].wis=v.value,placedObjects[selectedIndex].cha=O.value,placedObjects[selectedIndex].skills=j.value,placedObjects[selectedIndex].abilities=I.value,placedObjects[selectedIndex].spells=y.value),selectedNameVar.innerHTML=placedObjects[n].name,s.innerHTML=placedObjects[n].desc,i.value=placedObjects[n].ac,o.value=placedObjects[n].hp,m.value=placedObjects[n].size,p.value=placedObjects[n].speed,r.value=placedObjects[n].str,g.value=placedObjects[n].dex,u.value=placedObjects[n].con,b.value=placedObjects[n].int,v.value=placedObjects[n].wis,O.value=placedObjects[n].cha,j.value=placedObjects[n].skills,I.value=placedObjects[n].abilities,y.value=placedObjects[n].spells,selectedIndex=n,createNewObject(placedObjects[n].template);var h=window.sessionStorage.getItem("levelLoad");h=h.replace("enterlvl",""),loadObjectData(placedObjects[n].template,h,placedObjects[n][["name"]])}}setEntityData(placedObjects)})),canvas.addEventListener("mousedown",(function(e){if(isDown=!0,"edit"==state)for(var t=0;t<placedObjects.length;t++){if(null!=placedObjects[t])dist(canvasX,canvasY,parseFloat(placedObjects[t].x)+imgWidth/2,parseFloat(placedObjects[t].y)+imgHeight/2)<=.75*imgWidth&&(updateEntityValues(t,selectedNameVar=document.getElementById("namefield")),-1!=selectedIndex&&(placedObjects[selectedIndex].name=selectedNameVar.innerHTML),selectedNameVar.innerHTML=placedObjects[t].name,selectedIndex=t)}})),canvas.addEventListener("mouseup",(function(e){setEntityData(placedObjects);isDown=!1}));export function setState(e){state=e;setEntityData(placedObjects)}function clicked(e){console.log("Clicked:"+e),typeSelected=e,console.log("Changed to:"+typeSelected)}function dist(e,t,c,a){return Math.sqrt((e-c)**2+(t-a)**2)}function setImage(){"player"==typeSelected?img_icon.src=playerIconLink:typeSelected.includes("template")&&(img_icon.src=enemyIconLink)}function getNewName(){if("player"==typeSelected)return"Player"+ ++playersIndex;if(typeSelected.includes("template")){var e="template"+Math.max(typeSelected.replace("template",""),0);return console.log("searching:"+e),document.getElementById(e).querySelector("#template_name").innerHTML+placedObjects.length}return"entity"+placedObjects.length}var p_icon=document.getElementById("player_icon").onclick=function(){clicked("player")};function setOnClicks(){for(var e=0;document.getElementById("template"+e);){let t=0;t=e;document.getElementById("template"+e).querySelector("#template"+e+"_btn").onclick=function(){clicked("template"+t)};e++}}function updateEntityValues(e,t){t=document.getElementById("namefield");var c=document.getElementById("descfield"),a=document.getElementById("acfield"),l=document.getElementById("hpfield"),d=document.getElementById("sizefield"),n=document.getElementById("speedfield"),s=document.getElementById("strfield"),i=document.getElementById("dexfield"),o=document.getElementById("confield"),m=document.getElementById("intfield"),p=document.getElementById("wisfield"),r=document.getElementById("chafield"),g=document.getElementById("skillsfield"),u=document.getElementById("abilitiesfield"),b=document.getElementById("spellsfield");-1!=selectedIndex&&(placedObjects[selectedIndex].name=t.innerHTML,placedObjects[selectedIndex].desc=c.innerHTML,placedObjects[selectedIndex].ac=a.value,placedObjects[selectedIndex].hp=l.value,placedObjects[selectedIndex].size=d.value,placedObjects[selectedIndex].speed=n.value,placedObjects[selectedIndex].str=s.value,placedObjects[selectedIndex].dex=i.value,placedObjects[selectedIndex].con=o.value,placedObjects[selectedIndex].int=m.value,placedObjects[selectedIndex].wis=p.value,placedObjects[selectedIndex].cha=r.value,placedObjects[selectedIndex].skills=g.value,placedObjects[selectedIndex].abilities=u.value,placedObjects[selectedIndex].spells=b.value),t.innerHTML=placedObjects[e].name,c.innerHTML=placedObjects[e].desc,a.value=placedObjects[e].ac,l.value=placedObjects[e].hp,d.value=placedObjects[e].size,n.value=placedObjects[e].speed,s.value=placedObjects[e].str,i.value=placedObjects[e].dex,o.value=placedObjects[e].con,m.value=placedObjects[e].int,p.value=placedObjects[e].wis,r.value=placedObjects[e].cha,g.value=placedObjects[e].skills,u.value=placedObjects[e].abilities,b.value=placedObjects[e].spells,selectedIndex=e,createNewObject(placedObjects[e].template);var v=window.sessionStorage.getItem("levelLoad");v=v.replace("enterlvl",""),loadObjectData(placedObjects[e].template,v,placedObjects[e][["name"]])}function checkAndLoadFromFirebase(){if(!wasFirebaseLoaded){var e=loadedPreviousEntityData(placedObjects);placedObjects=entityData,wasFirebaseLoaded=e[0],clearInterval()}return wasFirebaseLoaded}function clearScreen(){placedObjects=[],playersIndex=0}console.log(!!p_icon),setOnClicks(),setInterval(checkAndLoadFromFirebase,500),setEntityData(placedObjects);