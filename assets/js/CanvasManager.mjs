console.log("Starting canvas code");import{createNewObject as e,loadObjectData as t,setEntityData as l,getTemplates as n,loadedPreviousEntityData as a}from"./FirebaseLoader.mjs";import{entityData as i}from"./FirebaseLoader.mjs";var d=document.getElementById("create_mode_btn"),o=document.getElementById("edit_mode_btn");d.onclick=function(){mode("create"),setState("create")},o.onclick=function(){mode("edit"),setState("edit")};var c=document.getElementById("#playersCanvas"),m=c.getContext("2d");m.font="16px Arial",m.canvas.width=.75*window.innerWidth,m.canvas.height=window.innerHeight/2;var u="https://pic.onlinewebfonts.com/svg/img_235012.png",s="https://media.discordapp.net/attachments/884300143548063754/985266517744685096/full-face.png",r="player",v=new Image;v.src=u;var f,g,p=[];m.fillStyle="#09f";var y,I=m.fillStyle,E="create",h=0,B=!1,w=!1;window.onload=function(){y=document.getElementById("namefield")},document.getElementById("clearbtn").onclick=function(){p=[],h=0};var L=-1;function x(e,t,l,n,a,i,d){t.complete&&e.drawImage(t,n,a,i,d)}c.addEventListener("mousemove",(function(e){m.canvas.width=.6*window.innerWidth,m.canvas.height=window.innerHeight/2;var t=c.getBoundingClientRect();f=Math.round(e.clientX-t.left),g=Math.round(e.clientY-t.top),m.clearRect(0,0,c.width,c.height),T();for(let e=0;e<p.length;e++){if("object"!=typeof p[e].img){var l=new Image;"player"==p[e].img?l.src=u:l.src=s,p[e].img=l}x(m,p[e].img,p[e].color,p[e].x,p[e].y,20,20)}"create"==E?(k(),x(m,v,I,f-10,g-10,20,20)):"edit"==E&&B&&b(parseFloat(p[L].x),parseFloat(p[L].y),f-10,g-10)<150&&(p[L].x=f-10,p[L].y=g-10)})),c.addEventListener("click",(function(a){if(T(),B=!1,"create"==E){var i=function(){if("player"==r)return"Player"+ ++h;if(r.includes("template")){var e="template"+Math.max(r.replace("template",""),0);return console.log("searching:"+e),document.getElementById(e).querySelector("#template_name").innerHTML+p.length}return"entity"+p.length}(),d=r;r.includes("template")&&(d=r.split("template")[1]);var o=n()[d],c={img:v,x:f-10,y:g-10,color:I,name:i,desc:"",template:d};for(var m in o)"name"!=m&&(c[m]=o[m],null!=o[m]&&"undefined"!=o[m]&&null!=o[m]||(c[m]="skills"!=m||"abilities"!=m||"spells"!=m||"desc"!=m?10:"N/A"));p.push(c),I="hsl("+360*Math.random()+", 50%, 50%",(v=new Image).src=u}else if("edit"==E)for(var s=0;s<p.length;s++){if(null!=p[s])if(b(f,g,parseFloat(p[s].x)+10,parseFloat(p[s].y)+10)<=15){S(s,y),y=document.getElementById("namefield");var w=document.getElementById("descfield"),x=document.getElementById("acfield"),M=document.getElementById("hpfield"),k=document.getElementById("sizefield"),H=document.getElementById("speedfield"),F=document.getElementById("strfield"),_=document.getElementById("dexfield"),z=document.getElementById("confield"),C=document.getElementById("intfield"),j=document.getElementById("wisfield"),q=document.getElementById("chafield"),A=document.getElementById("skillsfield"),R=document.getElementById("abilitiesfield"),W=document.getElementById("spellsfield");-1!=L&&(p[L].name=y.innerHTML,p[L].desc=w.innerHTML,p[L].ac=x.value,p[L].hp=M.value,p[L].size=k.value,p[L].speed=H.value,p[L].str=F.value,p[L].dex=_.value,p[L].con=z.value,p[L].int=C.value,p[L].wis=j.value,p[L].cha=q.value,p[L].skills=A.value,p[L].abilities=R.value,p[L].spells=W.value),y.innerHTML=p[s].name,w.innerHTML=p[s].desc,x.value=p[s].ac,M.value=p[s].hp,k.value=p[s].size,H.value=p[s].speed,F.value=p[s].str,_.value=p[s].dex,z.value=p[s].con,C.value=p[s].int,j.value=p[s].wis,q.value=p[s].cha,A.value=p[s].skills,R.value=p[s].abilities,W.value=p[s].spells,L=s,e(p[s].template);var N=window.sessionStorage.getItem("levelLoad");N=N.replace("enterlvl",""),t(p[s].template,N,p[s][["name"]])}}l(p)})),c.addEventListener("mousedown",(function(e){if(B=!0,"edit"==E)for(var t=0;t<p.length;t++){if(null!=p[t])b(f,g,parseFloat(p[t].x)+10,parseFloat(p[t].y)+10)<=15&&(S(t,y=document.getElementById("namefield")),-1!=L&&(p[L].name=y.innerHTML),y.innerHTML=p[t].name,L=t)}})),c.addEventListener("mouseup",(function(e){l(p);B=!1}));export function setState(e){E=e;l(p)}function M(e){console.log("Clicked:"+e),r=e,console.log("Changed to:"+r)}function b(e,t,l,n){return Math.sqrt((e-l)**2+(t-n)**2)}function k(){"player"==r?v.src=u:r.includes("template")&&(v.src=s)}var H=document.getElementById("player_icon").onclick=function(){M("player")};function T(){for(var e=0;document.getElementById("template"+e);){let t=0;t=e;document.getElementById("template"+e).querySelector("#template"+e+"_btn").onclick=function(){M("template"+t)};e++}}function S(l,n){n=document.getElementById("namefield");var a=document.getElementById("descfield"),i=document.getElementById("acfield"),d=document.getElementById("hpfield"),o=document.getElementById("sizefield"),c=document.getElementById("speedfield"),m=document.getElementById("strfield"),u=document.getElementById("dexfield"),s=document.getElementById("confield"),r=document.getElementById("intfield"),v=document.getElementById("wisfield"),f=document.getElementById("chafield"),g=document.getElementById("skillsfield"),y=document.getElementById("abilitiesfield"),I=document.getElementById("spellsfield");-1!=L&&(p[L].name=n.innerHTML,p[L].desc=a.innerHTML,p[L].ac=i.value,p[L].hp=d.value,p[L].size=o.value,p[L].speed=c.value,p[L].str=m.value,p[L].dex=u.value,p[L].con=s.value,p[L].int=r.value,p[L].wis=v.value,p[L].cha=f.value,p[L].skills=g.value,p[L].abilities=y.value,p[L].spells=I.value),n.innerHTML=p[l].name,a.innerHTML=p[l].desc,i.value=p[l].ac,d.value=p[l].hp,o.value=p[l].size,c.value=p[l].speed,m.value=p[l].str,u.value=p[l].dex,s.value=p[l].con,r.value=p[l].int,v.value=p[l].wis,f.value=p[l].cha,g.value=p[l].skills,y.value=p[l].abilities,I.value=p[l].spells,L=l,e(p[l].template);var E=window.sessionStorage.getItem("levelLoad");E=E.replace("enterlvl",""),t(p[l].template,E,p[l][["name"]])}console.log(!!H),T(),setInterval((function(){if(!w){var e=a(p);p=i,w=e[0],clearInterval()}return w}),500),l(p);